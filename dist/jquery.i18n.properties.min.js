"use strict";(function($){$.i18n={},$.i18n.map={};var debug=function(a){window.console&&console.log("i18n::"+a)};$.i18n.properties=function(a){var l={name:"Messages",language:"",path:"",namespace:null,mode:"vars",cache:!1,debug:!1,encoding:"UTF-8",async:!1,callback:null};a=$.extend(l,a),a.namespace&&typeof a.namespace=="string"&&(a.namespace.match(/^[a-z]*$/)?$.i18n.map[a.namespace]={}:(debug("Namespaces can only be lower case letters, a - z"),a.namespace=null)),a.path.match(/\/$/)||(a.path+="/"),a.language=this.normaliseLanguageCode(a);var u=a.name&&a.name.constructor===Array?a.name:[a.name];a.totalFiles=u.length*2+(a.language.length>=5?u.length:0),a.debug&&debug("totalFiles: "+a.totalFiles),a.filesLoaded=0,u.forEach(function(i){var s,e,r,o;s=a.path+i+".properties";var n=a.language.substring(0,2);if(e=a.path+i+"_"+n+".properties",a.language.length>=5){var t=a.language.substring(0,5);r=a.path+i+"_"+t+".properties",o=[s,e,r]}else o=[s,e];loadAndParseFiles(o,a)}),a.callback&&!a.async&&a.callback()},$.i18n.prop=function(a){var l=[].slice.call(arguments),u,i;if(l.length==2){if($.isArray(l[1]))u=l[1];else if(typeof l[1]=="object"){i=l[1].namespace;var s=l[1].replacements;l.splice(-1,1),s&&Array.prototype.push.apply(l,s)}}var e=i?$.i18n.map[i][a]:$.i18n.map[a];if(e===null||typeof e=="undefined")return"["+(i?i+"#"+a:a)+"]";var r;if(typeof e=="string"){for(r=0;(r=e.indexOf("\\",r))!=-1;)e.charAt(r+1)=="t"?e=e.substring(0,r)+"	"+e.substring(r+++2):e.charAt(r+1)=="r"?e=e.substring(0,r)+"\r"+e.substring(r+++2):e.charAt(r+1)=="n"?e=e.substring(0,r)+"\n"+e.substring(r+++2):e.charAt(r+1)=="f"?e=e.substring(0,r)+"\f"+e.substring(r+++2):e.charAt(r+1)=="\\"?e=e.substring(0,r)+"\\"+e.substring(r+++2):e=e.substring(0,r)+e.substring(r+1);var o=[],n,t;for(r=0;r<e.length;)if(e.charAt(r)=="'")if(r==e.length-1)e=e.substring(0,r);else if(e.charAt(r+1)=="'")e=e.substring(0,r)+e.substring(++r);else{for(n=r+2;(n=e.indexOf("'",n))!=-1;)if(n==e.length-1||e.charAt(n+1)!="'"){e=e.substring(0,r)+e.substring(r+1,n)+e.substring(n+1),r=n-1;break}else e=e.substring(0,n)+e.substring(++n);n==-1&&(e=e.substring(0,r)+e.substring(r+1))}else if(e.charAt(r)=="{")if(n=e.indexOf("}",r+1),n==-1)r++;else if(t=parseInt(e.substring(r+1,n)),!isNaN(t)&&t>=0){var f=e.substring(0,r);f!==""&&o.push(f),o.push(t),r=0,e=e.substring(n+1)}else r=n+1;else r++;e!==""&&o.push(e),e=o,i?$.i18n.map[settings.namespace][a]=o:$.i18n.map[a]=o}if(e.length===0)return"";if(e.length==1&&typeof e[0]=="string")return e[0];var c="";for(r=0,n=e.length;r<n;r++)typeof e[r]=="string"?c+=e[r]:u&&e[r]<u.length?c+=u[e[r]]:!u&&e[r]+1<l.length?c+=l[e[r]+1]:c+="{"+e[r]+"}";return c};function callbackIfComplete(a){a.debug&&(debug("callbackIfComplete()"),debug("totalFiles: "+a.totalFiles),debug("filesLoaded: "+a.filesLoaded)),a.async&&a.filesLoaded===a.totalFiles&&a.callback&&a.callback()}function loadAndParseFiles(a,l){l.debug&&debug("loadAndParseFiles"),a!==null&&a.length>0?loadAndParseFile(a[0],l,function(){a.shift(),loadAndParseFiles(a,l)}):callbackIfComplete(l)}function loadAndParseFile(a,l,u){l.debug&&(debug("loadAndParseFile('"+a+"')"),debug("totalFiles: "+l.totalFiles),debug("filesLoaded: "+l.filesLoaded)),a!==null&&typeof a!="undefined"&&$.ajax({url:a,async:l.async,cache:l.cache,dataType:"text",contentType:"Content-type: text/plain; charset="+l.encoding,beforeSend:function(i){i.overrideMimeType("text/html;charset="+l.encoding)},success:function(i,s){l.debug&&(debug("Succeeded in downloading "+a+"."),debug(i)),parseData(i,l),u()},error:function(i,s,e){l.debug&&debug("Failed to download or parse "+a+". errorThrown: "+e),i.status===404&&(l.totalFiles-=1),u()}})}function parseData(data,settings){for(var parsed="",lines=data.split(/\n/),regPlaceHolder=/(\{\d+})/g,regRepPlaceHolder=/\{(\d+)}/g,unicodeRE=/(\\u.{4})/ig,i=0,j=lines.length;i<j;i++){var line=lines[i];if(line=line.trim(),line.length>0&&line.match("^#")!="#"){var pair=line.split("=");if(pair.length>0){for(var name=decodeURI(pair[0]).trim(),value=pair.length==1?"":pair[1];value.search(/\\$/)!=-1;)value=value.substring(0,value.length-1),value+=lines[++i].replace(/\s+$/,"");for(var s=2;s<pair.length;s++)value+="="+pair[s];if(value=value.trim(),settings.mode=="map"||settings.mode=="both"){var unicodeMatches=value.match(unicodeRE);unicodeMatches&&unicodeMatches.forEach(function(a){value=value.replace(a,unescapeUnicode(a))}),settings.namespace?$.i18n.map[settings.namespace][name]=value:$.i18n.map[name]=value}if(settings.mode=="vars"||settings.mode=="both")if(value=value.replace(/"/g,'\\"'),checkKeyNamespace(name),regPlaceHolder.test(value)){var parts=value.split(regPlaceHolder),first=!0,fnArgs="",usedArgs=[];parts.forEach(function(a){regPlaceHolder.test(a)&&(usedArgs.length===0||usedArgs.indexOf(a)==-1)&&(first||(fnArgs+=","),fnArgs+=a.replace(regRepPlaceHolder,"v$1"),usedArgs.push(a),first=!1)}),parsed+=name+"=function("+fnArgs+"){";var fnExpr='"'+value.replace(regRepPlaceHolder,'"+v$1+"')+'"';parsed+="return "+fnExpr+";};"}else parsed+=name+'="'+value+'";'}}}eval(parsed),settings.filesLoaded+=1}function checkKeyNamespace(key){var regDot=/\./;if(regDot.test(key))for(var fullname="",names=key.split(/\./),i=0,j=names.length;i<j;i++){var name=names[i];i>0&&(fullname+="."),fullname+=name,eval("typeof "+fullname+' == "undefined"')&&eval(fullname+"={};")}}$.i18n.normaliseLanguageCode=function(a){var l=a.language;return(!l||l.length<2)&&(a.debug&&debug("No language supplied. Pulling it from the browser ..."),l=navigator.languages&&navigator.languages.length>0?navigator.languages[0]:navigator.language||navigator.userLanguage||"en",a.debug&&debug("Language from browser: "+l)),l=l.toLowerCase(),l=l.replace(/-/,"_"),l.length>3&&(l=l.substring(0,3)+l.substring(3).toUpperCase()),l};function unescapeUnicode(a){var l=[],u=parseInt(a.substr(2),16);return u>=0&&u<Math.pow(2,16)&&l.push(u),l.reduce(function(i,s){return i+String.fromCharCode(s)},"")}})(jQuery);
